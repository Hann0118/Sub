<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BiaoSUB 面板</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@3.9.4/dist/full.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>tailwind.config = { theme: { extend: { colors: { primary: '#6366f1', secondary: '#ec4899', accent: '#1fb2a6', } } } }</script>
    <link rel="stylesheet" href="/css/theme.css">
</head>

<body class="text-adaptive-base">
    <div id="app">
        <div v-if="!isLoggedIn"
            class="fixed inset-0 z-[999] flex items-center justify-center bg-black/70 backdrop-blur-md">
            <div class="card w-96 glass-panel shadow-2xl overflow-hidden">
                <div class="card-body text-center p-8">
                    <div class="mb-6"><i class="fa-solid fa-shield-halved text-6xl text-primary animate-pulse"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-adaptive-white mb-4">安全验证</h2>
                    <input type="password" v-model="loginPassword" @keyup.enter="handleLogin" placeholder="管理员密码"
                        class="input input-bordered w-full bg-adaptive-input text-center mb-6 text-lg" autofocus />
                    <button @click="handleLogin" class="btn btn-primary w-full btn-lg font-bold"
                        :disabled="loginLoading">
                        {{ loginLoading ? '正在验证...' : '开启面板' }}
                    </button>
                </div>
            </div>
        </div>

        <div class="container mx-auto px-4 py-8 max-w-5xl transition-all duration-500"
            :class="{ 'blur-sm pointer-events-none': !isLoggedIn }">
            <div class="navbar glass-panel rounded-2xl mb-8 shadow-xl">
                <div class="flex-1">
                    <a class="btn btn-ghost normal-case text-2xl font-bold text-adaptive-white">
                        <i class="fa-solid fa-bolt text-yellow-500 mr-2"></i> BiaoSUB
                    </a>
                </div>
                <div class="flex-none gap-2">
                    <!-- 主题切换按钮 -->
                    <button @click="toggleTheme" class="btn btn-circle btn-ghost tooltip tooltip-bottom"
                        :data-tip="theme === 'dark' ? '切换亮色' : '切换深色'">
                        <i v-if="theme === 'dark'" class="fa-solid fa-sun text-xl text-yellow-400"></i>
                        <i v-else class="fa-solid fa-moon text-xl text-adaptive-muted"></i>
                    </button>

                    <button @click="openSettings" class="btn btn-circle btn-ghost tooltip tooltip-bottom"
                        data-tip="设置"><i class="fa-solid fa-gear text-xl"></i></button>
                    <button @click="logout" class="btn btn-circle btn-ghost text-red-400 tooltip tooltip-bottom"
                        data-tip="退出"><i class="fa-solid fa-power-off text-xl"></i></button>
                </div>
            </div>

            <div class="tabs tabs-boxed glass-panel mb-8 p-1.5 shadow-xl border border-panel-border overflow-hidden">
                <a class="tab tab-lg flex-1 transition-all duration-300 gap-2 !h-12"
                    :class="{'tab-active bg-primary text-white shadow-md': currentTab === 'resources'}"
                    @click="currentTab = 'resources'">
                    <i class="fa-solid fa-database text-lg"></i> <span class="font-bold">资源池</span>
                </a>
                <a class="tab tab-lg flex-1 transition-all duration-300 gap-2 !h-12"
                    :class="{'tab-active bg-accent text-white shadow-md': currentTab === 'groups'}"
                    @click="currentTab = 'groups'">
                    <i class="fa-solid fa-layer-group text-lg"></i> <span class="font-bold">聚合订阅组</span>
                </a>
            </div>

            <div v-show="currentTab === 'resources'">
                <div v-if="isLoggedIn"
                    class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8 mt-4 animate-in fade-in zoom-in duration-500">
                    <!-- 单独节点 -->
                    <div class="glass-panel rounded-2xl p-4 hover:shadow-lg transition-all group">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-server"></i>
                            </div>
                            <div>
                                <div class="text-[10px] text-adaptive-muted uppercase tracking-wider font-bold">单独节点
                                </div>
                                <div class="text-xl font-bold text-adaptive-white">{{ stats.nodeCount }}</div>
                            </div>
                        </div>
                    </div>
                    <!-- 节点组 -->
                    <div class="glass-panel rounded-2xl p-4 hover:shadow-lg transition-all group">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-layer-group"></i>
                            </div>
                            <div>
                                <div class="text-[10px] text-adaptive-muted uppercase tracking-wider font-bold">节点组
                                </div>
                                <div class="text-xl font-bold text-adaptive-white">{{ stats.groupCount }}</div>
                            </div>
                        </div>
                    </div>
                    <!-- 聚合订阅 -->
                    <div class="glass-panel rounded-2xl p-4 hover:shadow-lg transition-all group">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center text-orange-400 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-link"></i>
                            </div>
                            <div>
                                <div class="text-[10px] text-adaptive-muted uppercase tracking-wider font-bold">聚合订阅
                                </div>
                                <div class="text-xl font-bold text-adaptive-white">{{ stats.aggregateCount }}</div>
                            </div>
                        </div>
                    </div>
                    <!-- 物理节点总数 -->
                    <div class="glass-panel rounded-2xl p-4 hover:shadow-lg transition-all group">
                        <div class="flex items-center gap-3">
                            <div
                                class="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400 group-hover:scale-110 transition-transform">
                                <i class="fa-solid fa-bolt"></i>
                            </div>
                            <div>
                                <div class="text-[10px] text-adaptive-muted uppercase tracking-wider font-bold">节点总数
                                </div>
                                <div class="text-xl font-bold text-adaptive-white">{{ stats.totalActualNodes }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-4">
                    <div class="text-sm text-adaptive-muted font-medium">所有原始订阅和自建节点</div>
                    <div class="flex gap-2">
                        <div v-if="batchMode" class="flex gap-2">
                            <button @click="selectAllResources" class="btn btn-sm btn-ghost">全选</button>
                            <button @click="executeBatchDelete" class="btn btn-sm btn-error text-white"
                                :disabled="selectedResources.length===0">删除选中 ({{selectedResources.length}})</button>
                            <button @click="batchMode=false; selectedResources=[]"
                                class="btn btn-sm btn-ghost">取消</button>
                        </div>
                        <button v-else @click="batchMode=true" class="btn btn-ghost btn-sm">批量管理</button>
                        <button @click="openRemoteModal()" class="btn btn-accent btn-sm text-white"><i
                                class="fa-solid fa-cloud-arrow-down mr-1"></i>导入订阅</button>
                        <button @click="openResourceModal()" class="btn btn-primary btn-sm"><i
                                class="fa-solid fa-plus"></i> 添加资源</button>
                    </div>
                </div>
                <div ref="resourceListEl" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div v-for="item in resources" :key="item.id" :data-id="item.id"
                        class="card glass-panel group transition-all duration-300 hover:shadow-2xl">
                        <div class="card-body p-5 relative">
                            <div class="flex justify-between items-start">
                                <div class="flex items-start gap-3">
                                    <div
                                        class="drag-handle cursor-move text-adaptive-muted opacity-50 hover:opacity-100 transition-opacity mt-1">
                                        <i class="fa-solid fa-grip-vertical"></i>
                                    </div>
                                    <input v-if="batchMode" type="checkbox" :value="item.id" v-model="selectedResources"
                                        class="checkbox checkbox-primary mt-1" />
                                    <div class="min-w-0">
                                        <h2 class="card-title text-base text-adaptive-white truncate pr-2">
                                            {{ item.name }}
                                            <span class="badge badge-sm font-bold"
                                                :class="item.type==='node'?'badge-secondary':item.type==='remote'?'badge-accent':'badge-primary'">{{
                                                item.type === 'remote' ? '远程' : item.type }}</span>
                                        </h2>
                                        <p
                                            class="text-xs text-adaptive-muted font-mono mt-1 break-all line-clamp-1 opacity-70">
                                            {{ item.type === 'remote' && item.source_url ? item.source_url : item.url }}
                                        </p>
                                    </div>
                                </div>
                                <div class="flex flex-col items-end gap-2 flex-shrink-0">
                                    <button
                                        @click="item.type === 'remote' ? refreshRemote(item) : refreshResource(item)"
                                        class="btn btn-xs btn-circle btn-ghost" :class="{'loading': item.refreshing}"
                                        :title="item.type === 'remote' ? '刷新远程订阅' : '刷新订阅信息'">
                                        <i v-if="!item.refreshing" class="fa-solid fa-rotate"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="mt-4 text-xs text-adaptive-muted flex items-center justify-between">
                                <span class="bg-black/5 dark:bg-white/5 px-2 py-0.5 rounded-full">资源 ID: {{ item.id
                                    }}</span>
                                <div>
                                    包含节点: <span class="text-primary font-bold">{{ item.info ? (item.info.nodeCount || 0)
                                        : 0 }}</span> 个
                                </div>
                            </div>

                            <div class="card-actions justify-end mt-4">
                                <button @click="previewNodes(item)" class="btn btn-xs btn-ghost">预览节点</button>
                                <button @click="editResource(item)" class="btn btn-xs btn-ghost">编辑</button>
                                <button @click="deleteResource(item.id)"
                                    class="btn btn-xs btn-ghost text-error">删除</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div v-show="currentTab === 'groups'">
                <div class="flex justify-between items-center mb-4">
                    <div class="text-sm text-adaptive-muted font-medium">创建独立的订阅链接，按需组合资源</div>
                    <button @click="openGroupModal()" class="btn btn-accent btn-sm text-white px-4">
                        <i class="fa-solid fa-plus-circle mr-1"></i> 新建聚合组
                    </button>
                </div>
                <div class="grid grid-cols-1 gap-6" ref="groupListEl">
                    <div v-for="group in groups" :key="group.id" :data-id="group.id" class="card glass-panel">
                        <div class="card-body p-5">
                            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                                <div class="flex items-center gap-3">
                                    <i
                                        class="fa-solid fa-grip-vertical drag-handle text-adaptive-muted opacity-30 cursor-move hover:opacity-60"></i>
                                    <div>
                                        <h2 class="card-title text-lg text-accent">{{ group.name }}</h2>
                                        <div class="text-xs text-adaptive-muted mt-1">包含资源: <span
                                                class="text-adaptive-white font-bold">{{ getGroupResourceCount(group)
                                                }}</span> 个</div>
                                        <div class="text-xs text-adaptive-muted mt-0.5">
                                            <i class="fa-solid fa-chart-simple text-info mr-1"></i>访问
                                            <span class="text-adaptive-white font-bold">{{ group.access_count || 0
                                                }}</span> 次
                                            <span v-if="group.last_accessed" class="ml-1 opacity-70">· {{
                                                formatTime(group.last_accessed) }}</span>
                                        </div>
                                    </div>
                                    <div class="flex gap-2 flex-wrap">
                                        <button @click="copyGroupLink(group, 'clash')"
                                            class="btn btn-sm bg-adaptive-input hover:bg-primary/10 text-adaptive-white border-panel-border shadow-sm">
                                            <i class="fa-solid fa-cat text-orange-400"></i> Clash
                                        </button>
                                        <button @click="copyGroupLink(group, 'base64')"
                                            class="btn btn-sm bg-adaptive-input hover:bg-primary/10 text-adaptive-white border-panel-border shadow-sm">
                                            <i class="fa-solid fa-link text-blue-400"></i> V2RayN
                                        </button>

                                        <button @click="refreshToken(group)" class="btn btn-sm btn-ghost text-warning"
                                            title="刷新密钥"><i class="fa-solid fa-key"></i></button>
                                        <button @click="editGroup(group)" class="btn btn-sm btn-ghost"><i
                                                class="fa-solid fa-pen"></i></button>
                                        <button @click="deleteGroup(group.id)"
                                            class="btn btn-sm btn-ghost text-error"><i
                                                class="fa-solid fa-trash"></i></button>
                                    </div>
                                </div>
                            </div>
                            <div class="divider my-1"></div>
                            <div class="flex flex-wrap gap-2" v-if="group.config && group.config.length > 0">
                                <span v-for="conf in group.config" :key="conf.subId"
                                    class="badge badge-neutral text-xs">
                                    {{ getResourceName(conf.subId) }}
                                    <span v-if="Array.isArray(conf.include) && conf.include.length > 0"
                                        class="ml-1 text-accent">({{
                                        conf.include.length }})</span>
                                    <span v-else class="ml-1 text-adaptive-muted opacity-50">(全)</span>
                                </span>
                            </div>
                            <div v-else class="text-xs text-adaptive-muted italic opacity-50">V2Ray: 未选择资源</div>

                            <div class="mt-2 text-xs" v-if="group.clash_config">
                                <span v-if="group.clash_config.mode === 'raw'" class="text-success font-bold">Clash:
                                    托管配置模式</span>
                                <span v-else class="text-adaptive-muted">Clash: 资源 <span
                                        class="text-accent font-bold">{{group.clash_config.resources ?
                                        group.clash_config.resources.length : 0}}</span> 个</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <dialog class="modal" :class="{ 'modal-open': resourceModal.show }">
                <div class="modal-box glass-panel">
                    <h3 class="font-bold text-lg text-adaptive-white mb-4">{{ resourceModal.isEdit ? '编辑资源' : '添加资源' }}
                    </h3>
                    <div class="flex flex-col gap-4">
                        <input type="text" v-model="resourceForm.name" placeholder="资源名称 (可选)"
                            class="input input-bordered w-full" />
                        <div class="tabs tabs-boxed">
                            <a class="tab flex-1" :class="{'tab-active': resourceForm.type==='group'}"
                                @click="resourceForm.type='group'">节点组</a>
                            <a class="tab flex-1" :class="{'tab-active': resourceForm.type==='node'}"
                                @click="resourceForm.type='node'">单独节点</a>
                        </div>
                        <div v-if="resourceForm.type==='group'">
                            <textarea v-model="resourceForm.url" @input="handleUrlInput" placeholder="请粘贴节点链接，每行一个。"
                                class="textarea textarea-bordered h-32 w-full"></textarea>
                        </div>
                        <div v-else>
                            <input type="text" v-model="resourceForm.url" @input="handleUrlInput"
                                placeholder="支持批量粘贴，会自动拆分为多个独立节点"
                                class="input input-bordered w-full bg-adaptive-input" />
                        </div>
                    </div>
                    <div class="modal-action">
                        <button class="btn btn-ghost" @click="resourceModal.show=false">取消</button>
                        <button class="btn btn-primary" @click="saveResource" :disabled="submitting">保存</button>
                    </div>
                </div>
            </dialog>

            <!-- Group Modal -->
            <dialog class="modal" :class="{ 'modal-open': groupModal.show }">
                <div class="modal-box glass-panel max-w-4xl w-11/12 p-0 overflow-hidden flex flex-col h-[90vh]">
                    <div class="p-6 border-b border-panel-border bg-adaptive-input">
                        <h3 class="font-bold text-xl text-adaptive-white flex items-center gap-2">
                            <i class="fa-solid fa-layer-group text-accent"></i> {{ groupModal.isEdit ? '编辑聚合组' : '新建聚合组'
                            }}
                        </h3>
                    </div>

                    <div class="flex-1 overflow-y-auto p-6">
                        <div class="form-control w-full mb-6">
                            <label class="label"><span class="label-text text-adaptive-white font-bold text-base">聚合组名称
                                    <span class="text-error">*</span></span></label>
                            <input type="text" v-model="groupForm.name" placeholder="请输入聚合组名称"
                                class="input input-bordered w-full bg-adaptive-input"
                                :class="{'input-error': groupNameError}" @input="groupNameError = false" />
                        </div>

                        <!-- 托管模式下隐藏 Tab，只显示名称和上传区域 -->
                        <div v-if="groupForm.clash_config.mode !== 'raw'"
                            class="tabs tabs-boxed bg-adaptive-input mb-6 shadow-inner border border-panel-border">
                            <a class="tab flex-1 transition-all duration-300"
                                :class="{'tab-active bg-primary text-white shadow-md': groupModal.tab==='base'}"
                                @click="groupModal.tab='base'">节点/资源选择</a>
                            <a class="tab flex-1 transition-all duration-300"
                                :class="{'tab-active bg-primary text-white shadow-md': groupModal.tab==='clash'}"
                                @click="groupModal.tab='clash'">Clash 配置</a>
                        </div>

                        <!-- Tab 1: 节点资源选择 (Unified) -->
                        <div v-show="groupModal.tab==='base'" class="flex flex-col gap-4">
                            <div class="flex justify-between items-center">
                                <div class="flex gap-2">
                                    <button @click="selectAllGroupResources" class="btn btn-xs btn-ghost text-accent">
                                        <i class="fa-solid fa-check-double"></i> 全选
                                    </button>
                                    <button @click="deselectAllGroupResources"
                                        class="btn btn-xs btn-ghost text-warning">
                                        <i class="fa-solid fa-xmark"></i> 取消全选
                                    </button>
                                </div>
                            </div>
                            <!-- 已选择的资源（可拖动排序） -->
                            <div v-if="groupForm.config.length > 0" class="mb-6">
                                <div class="text-sm font-bold text-adaptive-muted mb-3 flex items-center gap-2">
                                    <i class="fa-solid fa-check-circle text-success"></i> 已选择 (拖动手柄排序):
                                </div>
                                <div ref="groupResourceListEl"
                                    class="bg-adaptive-input rounded-xl p-3 flex flex-wrap gap-2 border border-panel-border min-h-12 shadow-inner">
                                    <div v-for="conf in groupForm.config" :key="conf.subId" :data-id="conf.subId"
                                        class="badge badge-accent badge-lg py-4 px-3 gap-2 cursor-move drag-handle font-bold text-white shadow-sm hover:scale-105 transition-transform">
                                        <i class="fa-solid fa-grip-vertical text-xs opacity-50"></i>
                                        {{ getResourceName(conf.subId) }}
                                        <button @click.stop="toggleResourceSelection(conf.subId, false)"
                                            class="hover:text-red-200 transition-colors">×</button>
                                    </div>
                                </div>
                            </div>
                            <!-- 可选择的资源 -->
                            <div class="text-sm font-bold text-adaptive-muted mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-plus-circle text-primary"></i> 可选择:
                            </div>
                            <div
                                class="max-h-80 overflow-y-auto custom-scrollbar bg-adaptive-input rounded-xl border border-panel-border shadow-inner">
                                <div v-for="res in resources" :key="res.id"
                                    class="p-4 border-b border-panel-border last:border-none hover:bg-primary/5 transition-colors">
                                    <div class="flex items-center justify-between">
                                        <label class="flex items-center gap-3 cursor-pointer flex-1">
                                            <input type="checkbox" class="checkbox checkbox-accent"
                                                :checked="isResourceSelected(res.id)"
                                                @change="toggleResourceSelection(res.id, $event.target.checked)" />
                                            <div>
                                                <div class="text-adaptive-base font-medium">{{ res.name }}</div>
                                                <div class="text-xs text-adaptive-muted mt-1">包含节点: {{ res.info ?
                                                    (res.info.nodeCount
                                                    || 0) : 0 }}
                                                </div>
                                            </div>
                                        </label>
                                        <button class="btn btn-xs btn-ghost text-accent"
                                            v-if="res.info && res.info.nodeCount > 0 && isResourceSelected(res.id)"
                                            @click="openNodeSelector(res)">
                                            <i class="fa-solid fa-filter"></i> 筛选节点
                                        </button>
                                    </div>
                                    <!-- 链式代理设置 -->
                                    <div v-if="isResourceSelected(res.id)" class="mt-2 pl-8 flex items-center gap-3">
                                        <label class="flex items-center gap-2 cursor-pointer">
                                            <input type="checkbox" class="toggle toggle-xs toggle-warning"
                                                :checked="getDialerProxy(res.id).enabled"
                                                @change="setDialerProxy(res.id, $event.target.checked, getDialerProxy(res.id).group)" />
                                            <span class="text-xs text-warning"><i
                                                    class="fa-solid fa-link mr-1"></i>链式代理</span>
                                        </label>
                                        <select v-if="getDialerProxy(res.id).enabled"
                                            class="select select-xs select-bordered bg-adaptive-input text-adaptive-white max-w-[150px]"
                                            :value="getDialerProxy(res.id).group"
                                            @change="setDialerProxy(res.id, true, $event.target.value)">
                                            <option value="">选择策略组</option>
                                            <option v-for="g in groupForm.clash_config.groups" :key="g.name"
                                                :value="g.name">{{ g.name }}</option>
                                        </select>
                                    </div>
                                </div>
                                <div v-if="resources.length===0" class="text-center py-4 text-adaptive-muted">暂无可用资源
                                </div>
                            </div>
                        </div>

                        <!-- Tab 2: Clash 配置 -->
                        <div v-show="groupModal.tab==='clash'" class="flex flex-col gap-4">
                            <div class="alert alert-info shadow-lg text-xs">
                                <i class="fa-solid fa-circle-info"></i>
                                <span>节点已在“节点/资源选择”中统一管理。此处仅需配置头部、策略组和规则。</span>
                            </div>
                            <div class="flex justify-end">
                                <button class="btn btn-sm btn-warning gap-1" @click="saveAsTemplate">
                                    <i class="fa-solid fa-star"></i> 保存为模板
                                </button>
                            </div>
                            <div class="collapse collapse-arrow bg-adaptive-input border border-panel-border mb-3">
                                <input type="checkbox" />
                                <div class="collapse-title text-sm font-bold text-adaptive-white">头部配置 (Header)</div>
                                <div class="collapse-content">
                                    <textarea v-model="groupForm.clash_config.header"
                                        class="code-editor w-full h-48 bg-black/5 text-adaptive-white p-3 text-[11px] outline-none resize-y rounded-lg border border-panel-border"></textarea>
                                </div>
                            </div>
                            <div class="collapse collapse-arrow bg-adaptive-input border border-panel-border mb-3">
                                <input type="checkbox" CHECKED />
                                <div class="collapse-title text-sm font-bold text-adaptive-white">策略组 (Proxy Groups)
                                </div>
                                <div class="collapse-content">
                                    <div class="flex justify-end mb-3">
                                        <button class="btn btn-xs btn-accent" @click="addClashGroup"><i
                                                class="fa-solid fa-plus mr-1"></i> 添加组</button>
                                    </div>
                                    <div v-for="(g, idx) in groupForm.clash_config.groups" :key="idx"
                                        class="p-4 border border-panel-border rounded-xl mb-3 bg-primary/5">
                                        <div class="flex gap-2 mb-3">
                                            <input v-model="g.name" placeholder="组名 (如 Proxy)"
                                                class="input input-sm input-bordered bg-adaptive-input text-adaptive-white w-1/3" />
                                            <select v-model="g.type"
                                                class="select select-sm select-bordered bg-adaptive-input text-adaptive-white w-1/3">
                                                <option value="select">select (手动选择)</option>
                                                <option value="url-test">url-test (自动测速)</option>
                                                <option value="fallback">fallback (故障转移)</option>
                                                <option value="load-balance">load-balance (负载均衡)</option>
                                            </select>
                                            <button @click="groupForm.clash_config.groups.splice(idx, 1)"
                                                class="btn btn-sm btn-ghost text-error"><i
                                                    class="fa-solid fa-trash-can"></i></button>
                                        </div>
                                        <div class="flex items-center gap-2 mt-2">
                                            <button @click="openClashNodeSelector(g)"
                                                class="btn btn-xs btn-outline btn-accent">
                                                <i class="fa-solid fa-list-check mr-1"></i> 选择节点
                                            </button>
                                            <span class="text-xs text-adaptive-muted">
                                                已选: <span class="text-accent font-bold">{{ g.proxies && g.proxies.length
                                                    > 0
                                                    ? g.proxies.length : '全部' }}</span>
                                            </span>
                                        </div>
                                        <div v-if="g.proxies && g.proxies.length > 0" class="mt-2 flex flex-wrap gap-1">
                                            <span v-for="pName in g.proxies.slice(0, 5)" :key="pName"
                                                class="badge badge-xs badge-neutral truncate max-w-[100px]">{{ pName
                                                }}</span>
                                            <span v-if="g.proxies.length > 5" class="badge badge-xs badge-ghost">+{{
                                                g.proxies.length - 5 }}</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="collapse collapse-arrow bg-adaptive-input border border-panel-border">
                                <input type="checkbox" />
                                <div class="collapse-title text-sm font-bold text-adaptive-white">分流规则 (Rules)</div>
                                <div class="collapse-content">
                                    <textarea v-model="groupForm.clash_config.rules"
                                        class="code-editor w-full h-64 bg-black/5 text-adaptive-white p-3 text-[11px] outline-none resize-y rounded-lg border border-panel-border"></textarea>
                                </div>
                            </div>
                        </div>

                        <!-- Tab 3: Raw Mode (托管配置) -->
                        <div v-show="groupForm.clash_config.mode === 'raw'" class="flex flex-col gap-4">
                            <div class="alert alert-info shadow-lg text-xs">
                                <i class="fa-solid fa-cloud-arrow-up"></i>
                                <span>托管模式：上传或粘贴完整的 Clash YAML 配置文件，订阅将直接返回此内容。</span>
                            </div>

                            <!-- 文件上传区域 -->
                            <div class="flex flex-col gap-3">
                                <label class="text-sm text-adaptive-muted font-bold">上传 YAML 配置文件：</label>
                                <div class="flex gap-2">
                                    <input type="file" accept=".yaml,.yml,.txt" @change="handleRawYamlUpload"
                                        class="file-input file-input-bordered file-input-accent w-full max-w-xs bg-adaptive-input shadow-sm" />
                                    <button v-if="groupForm.clash_config.raw_yaml"
                                        @click="groupForm.clash_config.raw_yaml = ''; groupForm.name = ''"
                                        class="btn btn-ghost btn-sm text-error">
                                        <i class="fa-solid fa-trash"></i> 清空
                                    </button>
                                </div>
                            </div>

                            <!-- YAML 内容预览/编辑 -->
                            <div class="flex flex-col gap-2">
                                <label class="text-sm font-bold text-adaptive-muted">配置内容：</label>
                                <textarea v-model="groupForm.clash_config.raw_yaml" placeholder="上传文件或在此粘贴 YAML 配置内容..."
                                    class="code-editor w-full h-80 bg-black/5 text-adaptive-white p-4 outline-none resize-y rounded-xl border border-panel-border"></textarea>
                            </div>
                        </div>

                        <div class="modal-action">
                            <button class="btn btn-ghost" @click="groupModal.show=false">取消</button>
                            <button class="btn btn-accent text-white" @click="saveGroup"
                                :disabled="submitting">保存聚合组</button>
                        </div>
                    </div>
                </div>
            </dialog>

            <!-- Template Selection Modal -->
            <dialog class="modal" :class="{ 'modal-open': templateModal.show }">
                <div class="modal-box glass-panel max-w-2xl">
                    <h3 class="font-bold text-xl text-adaptive-white mb-6 flex items-center gap-2">
                        <i class="fa-solid fa-wand-magic-sparkles text-accent"></i> 选择配置模板
                    </h3>
                    <div class="grid grid-cols-2 gap-4">
                        <button @click="selectTemplate('default')"
                            class="card bg-primary/5 hover:bg-primary/10 cursor-pointer border border-panel-border transition-all p-5 flex flex-col items-center gap-3 rounded-2xl group">
                            <i
                                class="fa-solid fa-wand-magic-sparkles text-4xl text-accent group-hover:scale-110 transition-transform"></i>
                            <div class="font-bold text-adaptive-white text-base">默认模板</div>
                            <div class="text-xs text-adaptive-muted text-center leading-relaxed">预置常用规则、DNS及策略组<br>(推荐)
                            </div>
                        </button>
                        <button @click="selectTemplate('blank')"
                            class="card bg-adaptive-input hover:bg-black/5 cursor-pointer border border-panel-border transition-all p-5 flex flex-col items-center gap-3 rounded-2xl group">
                            <i
                                class="fa-solid fa-file-code text-4xl text-adaptive-muted group-hover:scale-110 transition-transform"></i>
                            <div class="font-bold text-adaptive-white text-base">空白模板</div>
                            <div class="text-xs text-adaptive-muted text-center leading-relaxed">完全自定义配置<br>(高级用户)</div>
                        </button>
                        <button @click="selectTemplate('raw')"
                            class="card bg-warning/5 hover:bg-warning/10 cursor-pointer border border-panel-border transition-all p-5 flex flex-col items-center gap-3 rounded-2xl group">
                            <i
                                class="fa-solid fa-cloud-arrow-up text-4xl text-warning group-hover:scale-110 transition-transform"></i>
                            <div class="font-bold text-adaptive-white text-base">托管配置</div>
                            <div class="text-xs text-adaptive-muted text-center leading-relaxed">直接粘贴完整 YAML<br>(托管模式)
                            </div>
                        </button>
                        <!-- 我的模板 -->
                        <div class="card bg-yellow-400/5 border border-panel-border transition-all p-5 flex flex-col items-center gap-3 relative rounded-2xl group"
                            :class="{'bg-yellow-400/10': templateModal.showMyTemplates}">
                            <button
                                @click="templateModal.showMyTemplates = !templateModal.showMyTemplates; loadTemplates()"
                                class="w-full flex flex-col items-center gap-3">
                                <i
                                    class="fa-solid fa-star text-4xl text-yellow-500 group-hover:scale-110 transition-transform"></i>
                                <div class="font-bold text-adaptive-white text-base">我的模板</div>
                                <div class="text-xs text-adaptive-muted text-center leading-relaxed">自定义保存的模板<br>(点击展开)
                                </div>
                            </button>
                            <!-- 子菜单 -->
                            <div v-if="templateModal.showMyTemplates"
                                class="absolute top-full left-0 right-0 mt-3 bg-adaptive-input border border-panel-border rounded-xl shadow-2xl z-10 p-2 max-h-48 overflow-y-auto custom-scrollbar">
                                <div v-if="userTemplates.length === 0"
                                    class="text-center text-adaptive-muted text-sm py-4">
                                    暂无保存的模板
                                </div>
                                <div v-for="tpl in userTemplates" :key="tpl.id"
                                    class="flex items-center justify-between p-3 hover:bg-primary/5 rounded-lg cursor-pointer group/item mb-1 transition-colors">
                                    <button @click="selectUserTemplate(tpl)"
                                        class="flex-1 text-left text-adaptive-white text-sm font-medium pr-2">
                                        <i class="fa-solid fa-file-lines mr-2 text-accent opacity-70"></i>{{ tpl.name }}
                                    </button>
                                    <button @click.stop="deleteTemplate(tpl.id)"
                                        class="btn btn-xs btn-ghost text-error opacity-0 group-hover/item:opacity-100 transition-opacity">
                                        <i class="fa-solid fa-trash-can"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-action">
                        <button class="btn btn-ghost"
                            @click="templateModal.show=false; templateModal.showMyTemplates=false">取消</button>
                    </div>
                </div>
            </dialog>

            <dialog class="modal" :class="{ 'modal-open': nodeSelector.show }">
                <div class="modal-box glass-panel max-w-lg">
                    <h3 class="font-bold text-xl text-adaptive-white mb-4 flex items-center gap-2">
                        <i class="fa-solid fa-filter text-primary"></i> 筛选节点: <span class="text-accent">{{
                            nodeSelector.resourceName }}</span>
                    </h3>
                    <div v-if="nodeSelector.loading" class="py-12 text-center">
                        <span class="loading loading-spinner loading-lg text-primary"></span>
                        <div class="text-adaptive-muted mt-4 text-sm">正在加载节点列表...</div>
                    </div>
                    <div v-else>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs text-adaptive-muted">已选择: <span class="text-primary font-bold">{{
                                    nodeSelector.tempSelected.length }}</span> / {{ nodeSelector.nodes.length }}</span>
                            <div class="flex gap-2">
                                <button
                                    @click="nodeSelector.tempSelected = nodeSelector.nodes.map(n=>n.name); nodeSelector.selected='all'"
                                    class="btn btn-xs btn-ghost text-accent">全选</button>
                                <button @click="nodeSelector.tempSelected = []; nodeSelector.selected='select'"
                                    class="btn btn-xs btn-ghost text-warning">清空</button>
                            </div>
                        </div>
                        <div
                            class="max-h-80 overflow-y-auto custom-scrollbar bg-adaptive-input rounded-xl border border-panel-border p-2 shadow-inner">
                            <label v-for="node in nodeSelector.nodes" :key="node.name"
                                class="flex items-center gap-3 p-3 hover:bg-primary/5 cursor-pointer rounded-lg transition-colors mb-1 group">
                                <input type="checkbox" :value="node.name" v-model="nodeSelector.tempSelected"
                                    class="checkbox checkbox-sm checkbox-accent" />
                                <span class="text-sm text-adaptive-white truncate group-hover:font-medium">{{ node.name
                                    }}</span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-action">
                        <button class="btn btn-ghost" @click="nodeSelector.show=false">取消</button>
                        <button class="btn btn-accent text-white px-8" @click="confirmNodeSelection">确认选择</button>
                    </div>
                </div>
            </dialog>

            <dialog class="modal" :class="{ 'modal-open': clashNodeSelector.show }">
                <div class="modal-box glass-panel max-w-2xl">
                    <h3 class="font-bold text-xl text-adaptive-white mb-1 flex items-center gap-2">
                        <i class="fa-solid fa-list-check text-accent"></i> 选择节点进入策略组
                    </h3>
                    <p class="text-xs text-warning mb-6 flex items-center gap-1">
                        <i class="fa-solid fa-circle-info"></i> 此列表根据 Clash 配置中选中的资源实时生成。
                    </p>
                    <div v-if="clashNodeSelector.loading" class="py-12 text-center">
                        <span class="loading loading-spinner loading-lg text-accent"></span>
                        <div class="text-adaptive-muted mt-4 text-sm">正在加载所有节点...</div>
                    </div>
                    <div v-else>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs text-adaptive-muted">已选节点: <span class="text-accent font-bold">{{
                                    clashNodeSelector.tempSelected.length }}</span></span>
                            <div class="flex gap-2">
                                <button @click="clashSelectAll" class="btn btn-xs btn-ghost text-accent">全选</button>
                                <button @click="clashNodeSelector.tempSelected = []"
                                    class="btn btn-xs btn-ghost text-warning">清空</button>
                            </div>
                        </div>
                        <!-- 已选择的节点（可拖动排序） -->
                        <div v-if="clashNodeSelector.tempSelected.length > 0" class="mb-6">
                            <div class="text-sm font-bold text-adaptive-muted mb-3">已选择 (拖动手柄排序):</div>
                            <div ref="clashSelectedList"
                                class="bg-adaptive-input rounded-xl p-3 flex flex-wrap gap-2 border border-panel-border transition-all min-h-12 shadow-inner">
                                <div v-for="nodeName in clashNodeSelector.tempSelected" :key="nodeName"
                                    :data-id="nodeName" class="badge badge-secondary gap-1 cursor-move drag-handle">
                                    <i class="fa-solid fa-grip-vertical text-xs opacity-50"></i>
                                    {{ nodeName }}
                                    <button @click.stop="removeFromClashSelected(nodeName)"
                                        class="hover:text-red-400">×</button>
                                </div>
                            </div>
                        </div>

                        <!-- 可选择的策略组 (嵌套引用) -->
                        <div v-if="clashNodeSelector.allGroupNames.length > 0" class="mb-6">
                            <div class="text-sm font-bold text-adaptive-muted mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-layer-group text-accent"></i> 可选策略组 (引用组名):
                            </div>
                            <div
                                class="flex flex-wrap gap-2 bg-adaptive-input rounded-xl p-4 border border-panel-border shadow-inner">
                                <label v-for="gName in clashNodeSelector.allGroupNames" :key="'grp-'+gName"
                                    class="flex items-center gap-2 p-2 px-4 hover:bg-primary/5 cursor-pointer rounded-full border border-panel-border transition-all group/chip">
                                    <input type="checkbox" :value="gName" v-model="clashNodeSelector.tempSelected"
                                        class="checkbox checkbox-xs checkbox-warning" />
                                    <span
                                        class="text-sm text-adaptive-white font-bold group-hover/chip:text-primary transition-colors">{{
                                        gName }}</span>
                                </label>
                            </div>
                        </div>

                        <!-- 可选择的资源组 -->
                        <div v-if="clashNodeSelector.allResourceNames.length > 0" class="mb-6">
                            <div class="text-sm font-bold text-adaptive-muted mb-3 flex items-center gap-2">
                                <i class="fa-solid fa-box-archive text-primary"></i> 可选资源组 (引用整组节点):
                            </div>
                            <div
                                class="flex flex-wrap gap-2 bg-adaptive-input rounded-xl p-4 border border-panel-border shadow-inner">
                                <label v-for="resName in clashNodeSelector.allResourceNames" :key="'res-'+resName"
                                    class="flex items-center gap-2 p-2 px-4 hover:bg-primary/5 cursor-pointer rounded-full border border-panel-border transition-all group/chip">
                                    <input type="checkbox" :value="resName" v-model="clashNodeSelector.tempSelected"
                                        class="checkbox checkbox-xs checkbox-accent" />
                                    <span
                                        class="text-sm text-adaptive-white font-bold group-hover/chip:text-primary transition-colors">{{
                                        resName }}</span>
                                </label>
                            </div>
                        </div>

                        <!-- 分数线 -->
                        <div class="divider text-[10px] text-adaptive-muted my-4 uppercase tracking-widest">单节点选择</div>

                        <!-- 可选择的单节点 -->
                        <div
                            class="max-h-80 overflow-y-auto custom-scrollbar bg-adaptive-input rounded-xl p-2 grid grid-cols-1 sm:grid-cols-2 gap-2 border border-panel-border shadow-inner">
                            <label v-for="nodeName in clashNodeSelector.allNodeNames" :key="nodeName"
                                class="flex items-center gap-3 p-3 hover:bg-primary/5 cursor-pointer border border-transparent hover:border-panel-border rounded-xl transition-all group">
                                <input type="checkbox" :value="nodeName" v-model="clashNodeSelector.tempSelected"
                                    class="checkbox checkbox-sm checkbox-secondary group-hover:checkbox-accent" />
                                <span class="text-sm text-adaptive-white truncate group-hover:font-medium">{{ nodeName
                                    }}</span>
                            </label>
                        </div>
                    </div>
                    <div class="modal-action">
                        <button class="btn btn-ghost" @click="clashNodeSelector.show=false">取消</button>
                        <button class="btn btn-accent" @click="confirmClashNodeSelection">确认</button>
                    </div>
                </div>
            </dialog>

            <dialog class="modal" :class="{ 'modal-open': previewModal.show }">
                <div class="modal-box glass-panel max-w-4xl p-0 overflow-hidden flex flex-col h-[90vh]">
                    <div class="p-6 border-b border-panel-border bg-adaptive-input">
                        <h3 class="font-bold text-xl text-adaptive-white flex items-center gap-2">
                            <i class="fa-solid fa-layer-group text-accent"></i> 节点预览
                            <span class="badge badge-neutral ml-2">{{ previewModal.nodes.length }} 个</span>
                        </h3>
                        <div class="flex gap-2">
                            <!-- 普通模式下显示排序和编辑按钮 -->
                            <template v-if="!previewModal.sortMode && !previewModal.editMode">
                                <button @click="enterSortMode" class="btn btn-sm btn-outline btn-accent">
                                    <i class="fa-solid fa-sort"></i> 排序
                                </button>
                                <button v-if="previewModal.resourceItem && previewModal.resourceItem.type === 'group'"
                                    @click="enterEditMode" class="btn btn-sm btn-outline btn-warning">
                                    <i class="fa-solid fa-pen"></i> 编辑
                                </button>
                            </template>
                            <!-- 排序模式 -->
                            <template v-if="previewModal.sortMode">
                                <button @click="saveNodeOrder" class="btn btn-sm btn-success">
                                    <i class="fa-solid fa-save"></i> 保存排序
                                </button>
                                <button @click="cancelSortMode" class="btn btn-sm btn-ghost">取消</button>
                            </template>
                            <!-- 编辑模式 -->
                            <template v-if="previewModal.editMode">
                                <button @click="saveNodeEdits" class="btn btn-sm btn-success">
                                    <i class="fa-solid fa-save"></i> 保存编辑
                                </button>
                                <button @click="cancelEditMode" class="btn btn-sm btn-ghost">取消</button>
                            </template>
                        </div>
                    </div>

                    <div v-if="previewModal.sortMode" class="alert alert-info mb-3 py-2">
                        <i class="fa-solid fa-info-circle"></i>
                        <span class="text-sm">拖动节点调整顺序，完成后点击"保存排序"</span>
                    </div>

                    <div v-if="previewModal.editMode" class="alert alert-warning mb-3 py-2">
                        <i class="fa-solid fa-triangle-exclamation"></i>
                        <span class="text-sm">点击删除按钮移除节点，完成后点击"保存编辑"</span>
                    </div>

                    <div ref="previewListEl" class="max-h-96 overflow-y-auto bg-adaptive-input rounded p-2">
                        <div v-for="(node, idx) in previewModal.nodes" :key="node.link || idx"
                            class="text-xs text-adaptive-muted border-b border-panel-border py-2 flex items-center gap-2"
                            :class="{'bg-primary/10': previewModal.sortMode || previewModal.editMode}">
                            <!-- 排序模式拖动手柄 -->
                            <div v-if="previewModal.sortMode"
                                class="drag-handle cursor-move text-adaptive-muted opacity-50 hover:opacity-100 flex-shrink-0">
                                <i class="fa-solid fa-grip-vertical"></i>
                            </div>
                            <!-- 编辑模式删除按钮 -->
                            <button v-if="previewModal.editMode" @click="deleteNodeFromGroup(idx)"
                                class="btn btn-xs btn-circle btn-error flex-shrink-0">
                                <i class="fa-solid fa-minus"></i>
                            </button>
                            <div class="flex-1 min-w-0">
                                <div class="flex justify-between items-center">
                                    <span class="text-adaptive-white font-bold truncate pr-2">{{ node.name }}</span>
                                    <button @click="copyText(node.link)"
                                        class="btn btn-square btn-xs btn-ghost text-accent flex-shrink-0"><i
                                            class="fa-regular fa-copy"></i></button>
                                </div>
                                <div class="font-mono mt-1 truncate opacity-50 break-all">{{ node.link }}</div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-action">
                        <button class="btn btn-secondary btn-sm" @click="copyAllPreviewNodes">复制全部链接</button>
                        <button class="btn btn-ghost btn-sm" @click="closePreviewModal">关闭</button>
                    </div>
                </div>
            </dialog>


            <!-- Settings Modal -->
            <dialog class="modal" :class="{ 'modal-open': settingsModal.show }">
                <div class="modal-box glass-panel max-w-2xl">
                    <h3 class="font-bold text-xl text-adaptive-white mb-6 flex items-center gap-2">
                        <i class="fa-solid fa-gear text-accent"></i> 系统设置
                    </h3>


                    <!-- 数据备份 -->
                    <div class="collapse collapse-arrow bg-adaptive-input border border-panel-border mb-3">
                        <input type="checkbox" />
                        <div class="collapse-title text-sm font-medium text-adaptive-white flex items-center gap-2">
                            <i class="fa-solid fa-database text-info"></i> 数据备份
                        </div>
                        <div class="collapse-content">
                            <div class="flex flex-col gap-3 pt-2">
                                <button @click="exportBackup" class="btn btn-sm btn-info gap-1">
                                    <i class="fa-solid fa-download"></i> 导出备份
                                </button>
                                <div class="divider text-xs">或</div>
                                <input type="file" accept=".json" @change="importBackup"
                                    class="file-input file-input-bordered file-input-sm bg-adaptive-input w-full" />
                                <div class="text-xs text-adaptive-muted opacity-80 italic">
                                    <i class="fa-solid fa-info-circle mr-1"></i> 备份包含：资源池、聚合组、模板
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 关于 -->
                    <div class="bg-adaptive-input border border-panel-border rounded-2xl p-6 shadow-inner mb-4">
                        <div class="flex items-center gap-3 mb-2">
                            <i class="fa-solid fa-bolt text-yellow-500 text-2xl"></i>
                            <span class="font-bold text-adaptive-white text-xl">BiaoSUB</span>
                        </div>
                        <div class="text-sm text-adaptive-muted leading-relaxed">
                            轻量级订阅聚合管理面板，基于 Cloudflare Pages + D1。旨在提供极致、快速且美观的订阅聚合与管理体验。
                        </div>
                    </div>

                    <a href="https://github.com/0xdabiaoge/Biao-Sub" target="_blank"
                        class="btn btn-ghost hover:bg-primary/5 gap-2 w-full text-adaptive-muted group">
                        <i class="fa-brands fa-github text-xl group-hover:text-primary transition-colors"></i> 访问 GitHub
                        项目主页
                    </a>

                    <div class="modal-action">
                        <button class="btn btn-ghost" @click="settingsModal.show=false">关闭</button>
                    </div>
                </div>
            </dialog>

            <!-- 远程订阅弹窗 -->
            <dialog class="modal" :class="{ 'modal-open': remoteModal.show }">
                <div class="modal-box glass-panel max-w-lg">
                    <h3 class="font-bold text-lg text-adaptive-white mb-4">
                        <i class="fa-solid fa-cloud-arrow-down text-accent mr-2"></i>导入远程订阅
                    </h3>
                    <!-- 模式切换 -->
                    <div class="tabs tabs-boxed mb-4 bg-adaptive-input">
                        <a class="tab" :class="{'tab-active': remoteModal.mode === 'auto'}"
                            @click="remoteModal.mode='auto'">
                            <i class="fa-solid fa-bolt mr-1"></i>自动获取
                        </a>
                        <a class="tab" :class="{'tab-active': remoteModal.mode === 'manual'}"
                            @click="remoteModal.mode='manual'">
                            <i class="fa-solid fa-paste mr-1"></i>手动粘贴
                        </a>
                    </div>

                    <div class="flex flex-col gap-4">
                        <input type="text" v-model="remoteModal.name" placeholder="订阅名称 (可选)"
                            class="input input-bordered w-full" :disabled="remoteModal.loading" />

                        <!-- 自动获取模式 -->
                        <template v-if="remoteModal.mode === 'auto'">
                            <input type="text" v-model="remoteModal.url" placeholder="远程订阅链接 (必填)"
                                class="input input-bordered w-full" :disabled="remoteModal.loading" />
                            <div class="text-xs text-adaptive-muted opacity-70">
                                <i class="fa-solid fa-circle-info mr-1"></i>
                                如果机场屏蔽了 CF 请切换到"手动粘贴"模式
                            </div>
                        </template>

                        <!-- 手动粘贴模式 -->
                        <template v-else>
                            <input type="text" v-model="remoteModal.url" placeholder="订阅源 URL (可选，方便记录来源)"
                                class="input input-bordered input-sm w-full" :disabled="remoteModal.loading" />
                            <textarea v-model="remoteModal.content" placeholder="粘贴订阅内容（支持 Base64 编码和节点链接）"
                                class="textarea textarea-bordered w-full h-32 font-mono text-xs"
                                :disabled="remoteModal.loading"></textarea>
                            <div class="text-xs text-adaptive-muted opacity-70">
                                <i class="fa-solid fa-circle-info mr-1"></i>
                                在浏览器中打开订阅链接，复制全部内容粘贴到上方
                            </div>
                        </template>

                        <div v-if="remoteModal.loading" class="text-sm text-info flex items-center gap-2">
                            <span class="loading loading-spinner loading-sm"></span>
                            {{ remoteModal.mode === 'auto' ? '正在获取远程订阅...' : '正在解析...' }}
                        </div>
                    </div>
                    <div class="modal-action">
                        <button class="btn btn-ghost" @click="remoteModal.show=false"
                            :disabled="remoteModal.loading">取消</button>
                        <button class="btn btn-accent text-white" @click="saveRemoteSubscription()"
                            :disabled="remoteModal.loading || (remoteModal.mode === 'auto' ? !remoteModal.url : !remoteModal.content)">
                            <i class="fa-solid fa-download mr-1"></i>导入
                        </button>
                    </div>
                </div>
            </dialog>

            <div v-if="toast.show" class="toast toast-bottom toast-end z-50">
                <div class="alert shadow-lg text-white"
                    :class="toast.type === 'success' ? 'alert-success' : 'alert-error'">
                    <span>{{ toast.message
                        }}</span>
                </div>
            </div>
        </div>
    </div>


    <script type="module" src="/js/app.js"></script>


</body>

</html>